<!DOCTYPE html>
<html>
<head><title>VNC Test</title></head>
<body style="margin:0; background:#000; color:#0f0; font-family:monospace;">
<h3 style="padding:10px;">VNC Direct Test â€” ws://192.168.1.37:6080</h3>
<div id="log" style="padding:10px; font-size:12px;"></div>
<div id="vnc" style="width:800px; height:600px; border:1px solid #0f0; margin:10px;"></div>
<script type="module">
  const log = (msg) => { document.getElementById('log').innerHTML += msg + '<br>'; console.log(msg); };
  
  log('Loading noVNC...');
  try {
    const { default: RFB } = await import('/node_modules/@novnc/novnc/lib/rfb.js');
    log('noVNC loaded. Connecting to ws://192.168.1.37:6080 ...');
    
    const rfb = new RFB(document.getElementById('vnc'), 'ws://192.168.1.37:6080', {
      credentials: { password: '137009' },
      wsProtocols: ['binary'],
    });
    
    rfb.scaleViewport = true;
    rfb.resizeSession = false;
    rfb.qualityLevel = 6;
    rfb.compressionLevel = 2;
    
    rfb.addEventListener('connect', () => log('âœ… CONNECTED!'));
    rfb.addEventListener('disconnect', (e) => log('âŒ DISCONNECTED: clean=' + e.detail?.clean));
    rfb.addEventListener('securityfailure', (e) => log('ðŸ”’ AUTH FAILED: ' + (e.detail?.reason || 'unknown')));
    rfb.addEventListener('credentialsrequired', (e) => log('ðŸ”‘ CREDENTIALS REQUIRED: ' + JSON.stringify(e.detail)));
    
    log('RFB instance created. Waiting for events...');
  } catch (err) {
    log('ERROR: ' + err.message);
    log(err.stack);
  }
</script>
</body>
</html>
